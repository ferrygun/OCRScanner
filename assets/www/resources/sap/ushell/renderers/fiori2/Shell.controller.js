// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['sap/ushell/ui5service/ShellUIService','sap/ui/core/IconPool','sap/ushell/CanvasShapesManager','./AccessKeysHandler','./History','./Lifecycle','./ShellModel','sap/ushell/services/AppConfiguration','sap/ushell/services/AppType','sap/ushell/services/Message','sap/ushell/services/Notifications','sap/ushell/services/ShellNavigation','sap/ushell/ui/launchpad/Fiori2LoadingDialog','sap/ushell/utils','sap/ushell/components/container/ApplicationContainer'],function(S,I,C,A,H,L,a,b,c,M,N,d,F,u,f){"use strict";var g=true,h=true,p=false,B=false,s,m,n={embedded:"embedded",newWindowThenEmbedded:"newWindowThenEmbedded",newWindow:"newWindow",replace:"replace"},o={},j,k=['minimal','app','standalone','embedded','headerless','merged','home','blank'],l,q=false,r=false;sap.ui.controller("sap.ushell.renderers.fiori2.Shell",{onInit:function(){h=true;B=false;g=true;var e=window.matchMedia("(min-width: 600px)"),i;var o=(this.getView().getViewData()?this.getView().getViewData().config:{})||{};this.initPromises();this.bMeAreaSelected=false;this.oEndUserFeedbackConfiguration={showAnonymous:true,anonymousByDefault:true,showLegalAgreement:true,showCustomUIContent:true,feedbackDialogTitle:true,textAreaPlaceholder:true,customUIContent:undefined};this.bUserImageAlreadyLoaded=undefined;this.bMeAreaLoaded=false;this.bNotificationsSelected=false;o["enableBackGroundShapes"]=o.enableBackGroundShapes===undefined?true:o.enableBackGroundShapes;j=this._historyBackNavigation;this.initShellModel(o);i=function(w){m.setProperty('/isPhoneWidth',!w.matches);};if(e.addListener){e.addListener(i);i(e);}this.getView().setModel(m);this.getView().setModel(sap.ushell.resources.i18nModel,"i18n");sap.ui.getCore().getEventBus().subscribe("externalSearch",this.externalSearchTriggered,this);this._setConfigurationToModel();if(o.moveEditHomePageActionToShellHeader){sap.ui.getCore().getEventBus().subscribe("showCatalog",this._hideEditButton,this);}sap.ui.getCore().getEventBus().subscribe("launchpad","contentRendered",this._loadCoreExt,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.loadUserImage,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.setBackGroundShapes,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell","coreResourcesFullyLoaded",this._postCoreExtActivities,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.delayedCloseLoadingScreen,this);sap.ui.getCore().getEventBus().subscribe("launchpad","toggleContentDensity",this.toggleContentDensity,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this._loadCoreExtNonUI5,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);sap.ui.getCore().getEventBus().subscribe("launchpad","appClosed",this.logApplicationUsage,this);sap.ui.getCore().getEventBus().subscribe("launchpad","shellFloatingContainerDockedIsResize",this._onResizeWithDocking,this);sap.ui.getCore().getEventBus().subscribe("launchpad","launchpadCustomRouterRouteMatched",this._centerViewPort,this);sap.ushell.Container.getService("AppLifeCycle");if(sap.ushell.Container.getService("Notifications").isEnabled()===true){m.setProperty("/enableNotifications",true);sap.ushell.Container.getService("Notifications").init();if(o.enableNotificationsUI===true){m.setProperty("/enableNotificationsUI",true);sap.ushell.Container.getService("Notifications").registerDependencyNotificationsUpdateCallback(this.notificationsCountUpdateCallback.bind(this),true);}}this.history=new H();this.oViewPortContainer=sap.ui.getCore().byId("viewPortContainer");this.oNotificationsCountButton=sap.ui.getCore().byId("NotificationsCountButton");this.oFiori2LoadingDialog=sap.ui.getCore().byId("Fiori2LoadingDialog");this.oShellNavigation=sap.ushell.Container.getService("ShellNavigation");this.oShellNavigation.registerNavigationFilter(jQuery.proxy(this._handleEmptyHash,this));this.oShellNavigation.init(jQuery.proxy(this.doHashChange,this));this.oShellNavigation.registerNavigationFilter(jQuery.proxy(this.handleDataLoss,this));sap.ushell.Container.getService("Message").init(jQuery.proxy(this.doShowMessage,this));sap.ushell.Container.setLogonFrameProvider(this._getLogonFrameProvider());this.bContactSupportEnabled=sap.ushell.Container.getService("SupportTicket").isEnabled();A.init(m);window.onbeforeunload=function(){if(sap.ushell.Container&&sap.ushell.Container.getDirtyFlag()){if(!sap.ushell.resources.browserI18n){sap.ushell.resources.browserI18n=sap.ushell.resources.getTranslationModel(window.navigator.language).getResourceBundle();}return sap.ushell.resources.browserI18n.getText("dataLossExternalMessage");}};if(m.getProperty("/contentDensity")){this._applyContentDensityClass();}if(m.getProperty("/enableNotificationsUI")===true){s.addHeaderEndItem(["NotificationsCountButton"],false,["home","app","minimal"],true);}sap.ui.Device.media.attachHandler(this.onScreenSizeChange.bind(this),null,sap.ui.Device.media.RANGESETS.SAP_STANDARD);this.onScreenSizeChange(sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD));this.initShellUIService();if(this.getView().oShellNavigationMenu){this.getView().oShellNavigationMenu.setModel(m);}sap.ui.getCore().attachThemeChanged(this.redrawBackGroundShapes);if(o.sessionTimeoutIntervalInMinutes){var t=20000,v=this;setTimeout(function(){v._createSessionHandler(o);},t);}},initPromises:function(){l=jQuery.Deferred();},initShellModel:function(o){s=a;s.init(o);m=s.getModel();},redrawBackGroundShapes:function(){if(o.enableBackGroundShapes){C.drawShapes();}},setBackGroundShapes:function(){var v=this.getView(),m=v.getModel(),e=m.getProperty('/animationMode')!=='minimal';if(!B&&o.enableBackGroundShapes){B=true;C.drawShapes();C.enableAnimationDrawing(e);}},initShellUIService:function(){this.oShellUIService=new S({scopeObject:this.getOwnerComponent(),scopeType:"component"});this.oShellUIService._attachHierarchyChanged(this.onHierarchyChange.bind(this));this.oShellUIService._attachTitleChanged(this.onTitleChange.bind(this));this.oShellUIService._attachRelatedAppsChanged(this.onRelatedAppsChange.bind(this));this.oShellUIService._attachBackNavigationChanged(this.onBackNavigationChange.bind(this));if(o.enableOnlineStatus){sap.ui.require(["sap/ushell/ui5service/UserStatus"],function(U){this.oUserStatus=new U({scopeObject:this.getOwnerComponent(),scopeType:"component"});this.oUserStatus.attachEnabledStatusChanged(function(e){this.getModel().setProperty("/userStatusEnabled",e.mParameters.data);}.bind(this));this.oUserStatus.attachStatusChanged(function(e){this.getModel().setProperty("/userStatus",e.mParameters.data);if(e.mParameters.data==null){this.getModel().setProperty("/userStatusUserEnabled",false);}else{this.getModel().setProperty("/userStatusUserEnabled",true);}}.bind(this));}.bind(this));}},onHierarchyChange:function(e){this.isHierarchyChanged=true;var i=e.getParameters().data,t,E=[],v;if(!i){i=[];}t=this.getHierarchyDefaultValue();i.forEach(function(w,x){E[x]=jQuery.extend({},w);});E=E.concat(t);v=m.getProperty("/currentState");if(v&&v.stateName==="home"){s.updateStateProperty("application/hierarchy",E,false,["home"]);}s.updateStateProperty("application/hierarchy",E,true);},onTitleChange:function(e){this.isTitleChanged=true;var t=e.getParameters().data,i;if(!t){t=this.getTitleDefaultValue();}i=m.getProperty("/currentState");if(i&&i.stateName==="home"){s.updateStateProperty("application/title",t,false,["home"]);}s.updateStateProperty("application/title",t,true);window.document.title=t;},onBackNavigationChange:function(e){this.isBackNavigationChanged=true;var i=e.getParameters().data,m=this.getModel(),t=m.getProperty('/currentState/');if(i){j=i;if(t.stateName==='minimal'||t.stateName==='standalone'||t.stateName==='embedded'){sap.ushell.Container.getRenderer('fiori2').showHeaderItem('backBtn',true);}}else{j=this._historyBackNavigation;}},onRelatedAppsChange:function(e){this.isRelatedAppsChanged=true;var R=e.getParameters().data,i;if(!R){R=[];}i=m.getProperty("/currentState");if(i&&i.stateName==="home"){s.updateStateProperty("application/relatedApps",R,false,["home"]);}s.updateStateProperty("application/relatedApps",R,true);},getHierarchyDefaultValue:function(){var e=[],i=m.getProperty("/currentState");if(i&&(i.stateName==="app"||i.stateName==="embedded")){e=[{icon:"sap-icon://home",title:sap.ushell.resources.i18n.getText("actionHomePage"),intent:o.rootIntent?"#"+o.rootIntent:"#"}];}return e;},getTitleDefaultValue:function(){var t="",e=b.getMetadata();if(e&&e.title){t=e.title;}return t;},getAppIcon:function(){var i="sap-icon://folder",e=b.getMetadata();if(e&&e.icon){i=e.icon;}return i;},_handleAlerts:function(e,E,i){var t;if(this.oViewPortContainer.getCurrentState()!=='RightCenter'){for(t=0;t<i.length;t++){this.handleNotification(i[t]);}}},handleNotification:function(e){var i=sap.ushell.Container.getRenderer("fiori2").addRightFloatingContainerItem({press:function(E){var v=sap.ui.getCore().byId('viewPortContainer');if(hasher.getHash()===e.NavigationTargetObject+"-"+e.NavigationTargetAction){v.switchState("Center");}else{u.toExternalWithParameters(e.NavigationTargetObject,e.NavigationTargetAction,e.NavigationTargetParams);}sap.ushell.Container.getService("Notifications").markRead(e.Id);},datetime:sap.ushell.resources.i18n.getText("notification_arrival_time_now"),title:e.SensitiveText?e.SensitiveText:e.Text,description:e.SubTitle,unread:e.IsRead,priority:"High",hideShowMoreButton:true},true,true);setTimeout(function(){sap.ushell.Container.getRenderer("fiori2").removeRightFloatingContainerItem(i.getId(),true);},3500);},_createActionButtons:function(){var e,t,E,i,U=sap.ui.getCore().byId("userSettingsBtn"),v=sap.ui.getCore().byId("aboutBtn")||new sap.ushell.ui.footerbar.AboutButton("aboutBtn");t=this;if(!U){var w="userSettingsBtn";var x=sap.ushell.resources.i18n.getText("userSettings");var y='sap-icon://action-settings';if(!o.moveUserSettingsActionToShellHeader){U=new sap.ushell.ui.launchpad.ActionItem("userSettingsBtn",{id:w,text:x,icon:y});}}this.getView().aDanglingControls.push(U);jQuery.sap.require('sap.ushell.ui.footerbar.ContactSupportButton');e=sap.ui.getCore().byId("ContactSupportBtn");if(!e){if(!o.moveContactSupportActionToShellHeader){e=new sap.ushell.ui.footerbar.ContactSupportButton("ContactSupportBtn",{visible:this.bContactSupportEnabled});}}this.getView().aDanglingControls.push(e);i=m.getProperty('/showEndUserFeedback');if(i){if(o.moveGiveFeedbackActionToShellHeader){jQuery.sap.measure.start("FLP:Shell.controller._createActionButtons","create give feedback as shell head end item","FLP");var z=sap.ui.getCore().byId("EndUserFeedbackHandlerBtn");z.setModel(m);z.setShowAnonymous(this.oEndUserFeedbackConfiguration.showAnonymous);z.setAnonymousByDefault(this.oEndUserFeedbackConfiguration.anonymousByDefault);z.setShowLegalAgreement(this.oEndUserFeedbackConfiguration.showLegalAgreement);z.setShowCustomUIContent(this.oEndUserFeedbackConfiguration.showCustomUIContent);z.setFeedbackDialogTitle(this.oEndUserFeedbackConfiguration.feedbackDialogTitle);z.setTextAreaPlaceholder(this.oEndUserFeedbackConfiguration.textAreaPlaceholder);z.setAggregation("customUIContent",this.oEndUserFeedbackConfiguration.customUIContent,false);var D=function(){z.firePress();};E=sap.ui.getCore().byId("EndUserFeedbackBtn");E.setVisible(true);E.attachPress(D);jQuery.sap.measure.end("FLP:Shell.controller._createActionButtons");}else{jQuery.sap.require('sap.ushell.ui.footerbar.EndUserFeedback');E=sap.ui.getCore().byId("EndUserFeedbackBtn")||new sap.ushell.ui.footerbar.EndUserFeedback("EndUserFeedbackBtn",{showAnonymous:this.oEndUserFeedbackConfiguration.showAnonymous,anonymousByDefault:this.oEndUserFeedbackConfiguration.anonymousByDefault,showLegalAgreement:this.oEndUserFeedbackConfiguration.showLegalAgreement,showCustomUIContent:this.oEndUserFeedbackConfiguration.showCustomUIContent,feedbackDialogTitle:this.oEndUserFeedbackConfiguration.feedbackDialogTitle,textAreaPlaceholder:this.oEndUserFeedbackConfiguration.textAreaPlaceholder,customUIContent:this.oEndUserFeedbackConfiguration.customUIContent});}}if(m.getProperty("/enableHelp")){U.addStyleClass('help-id-loginDetails');v.addStyleClass('help-id-aboutBtn');if(i){E.addStyleClass('help-id-EndUserFeedbackBtn');}e.addStyleClass('help-id-contactSupportBtn');}this.getView().aDanglingControls.push(v);if(i){this.getView().aDanglingControls.push(E);}},_isCompactContentDensityByDevice:function(){var i;if(!sap.ui.Device.support.touch||sap.ui.Device.system.combi){i=true;}else{i=false;}return i;},_applyContentDensityByPriority:function(i){if(i===undefined){if(sap.ui.Device.system.combi){var e=sap.ushell.Container.getService("UserInfo"),U=e.getUser(),t="autoDetect";if(U){t=U.getContentDensity();}switch(t){case"cozy":i=false;break;case"compact":i=true;break;default:var v=b.getMetadata();if(v.compactContentDensity&&!v.cozyContentDensity){i=true;}else{i=false;}}}else{var v=b.getMetadata();if(v.compactContentDensity&&!v.cozyContentDensity){i=true;}else{if(!v.compactContentDensity&&v.cozyContentDensity){i=false;}else{i=this._isCompactContentDensityByDevice();}}}}this._applyContentDensityClass(i);},_applyContentDensityClass:function(i){if(i===undefined){var e=sap.ushell.Container.getService("UserInfo"),U=e.getUser?e.getUser():undefined;if(U&&U.getContentDensity()==='cozy'){i=false;}else{i=this._isCompactContentDensityByDevice();}}if(i){jQuery('body').removeClass('sapUiSizeCozy');jQuery('body').addClass('sapUiSizeCompact');}else{jQuery('body').removeClass('sapUiSizeCompact');jQuery('body').addClass('sapUiSizeCozy');}},toggleContentDensity:function(e,E,D){var i=D.contentDensity==="compact";this._applyContentDensityByPriority(i);},loadMeAreaView:function(){if(!sap.ui.getCore().byId('meArea')&&!this.bMeAreaLoaded){this.bMeAreaLoaded=true;var e=sap.ui.view("meArea",{viewName:"sap.ushell.renderers.fiori2.meArea.MeArea",type:'JS',viewData:this.getView().getViewData()});this._createActionButtons();this._setUserPrefModel();this.oViewPortContainer.addLeftViewPort(e);this.oViewPortContainer.navTo('leftViewPort',e.getId());this.oViewPortContainer.attachAfterSwitchStateAnimationFinished(function(D){if(D.getParameter("to")==="LeftCenter"&&!r){setTimeout(function(){this._getSearchPrefs();}.bind(this),0);}}.bind(this));}},notificationsCountUpdateCallback:function(D){var t=this,v=this.oViewPortContainer.getCurrentState(),i=v==="RightCenter"?true:false;if((D===undefined)||(!i)){this._updateBadge();}else{D.done(function(){t._updateBadge();});}},_updateBadge:function(){var e;sap.ushell.Container.getService("Notifications").getUnseenNotificationsCount().done(function(i){e=parseInt(i,10);m.setProperty('/notificationsCount',e);}).fail(function(i){jQuery.sap.log.error("Shell.controller - call to notificationsService.getCount failed: ",i,"sap.ushell.renderers.lean.Shell");});},_handleEmptyHash:function(e){e=(typeof e==="string")?e:"";e=e.split("?")[0];if(e.length===0){var v=this.getView()?this.getView().getViewData():{};o=v.config||{};if(o.migrationConfig){return this.oShellNavigation.NavigationFilterStatus.Continue;}if(o.rootIntent){setTimeout(function(){hasher.setHash(o.rootIntent);},0);return this.oShellNavigation.NavigationFilterStatus.Abandon;}}return this.oShellNavigation.NavigationFilterStatus.Continue;},_setConfigurationToModel:function(){var v=this.getView().getViewData(),e,i;if(v){o=v.config||{};}if(o){if(o.states){i=m.getProperty('/states');for(e in o.states){if(o.states.hasOwnProperty(e)){i[e]=o.states[e];}}m.setProperty('/states',i);}if(o.appState==="headerless"||o.appState==="merged"||o.appState==="blank"){m.setProperty("/personalization",false);o.enablePersonalization=false;}else if(o.enablePersonalization!==undefined){m.setProperty("/personalization",o.enablePersonalization);}if(o.changeEndUserFeedbackTitle!==undefined){this.oEndUserFeedbackConfiguration.feedbackDialogTitle=o.changeEndUserFeedbackTitle;}if(o.changeEndUserFeedbackPlaceholder!==undefined){this.oEndUserFeedbackConfiguration.textAreaPlaceholder=o.changeEndUserFeedbackPlaceholder;}if(o.showEndUserFeedbackAnonymousCheckbox!==undefined){this.oEndUserFeedbackConfiguration.showAnonymous=o.showEndUserFeedbackAnonymousCheckbox;}if(o.makeEndUserFeedbackAnonymousByDefault!==undefined){this.oEndUserFeedbackConfiguration.anonymousByDefault=o.makeEndUserFeedbackAnonymousByDefault;}if(o.showEndUserFeedbackLegalAgreement!==undefined){this.oEndUserFeedbackConfiguration.showLegalAgreement=o.showEndUserFeedbackLegalAgreement;}if(o.enableSetTheme!==undefined){m.setProperty("/setTheme",o.enableSetTheme);}m.setProperty("/contentDensity",o.enableContentDensity===undefined?true:o.enableContentDensity);if(o.title){m.setProperty("/title",o.title);}if(o.migrationConfig!==undefined){m.setProperty("/migrationConfig",o.migrationConfig);}if(o.enableUserDefaultParameters!==undefined){m.setProperty("/userDefaultParameters",o.enableUserDefaultParameters);}if(o.disableHomeAppCache!==undefined){m.setProperty("/disableHomeAppCache",o.disableHomeAppCache);}m.setProperty("/enableHelp",!!o.enableHelp);m.setProperty("/searchAvailable",(o.enableSearch!==false));m.bindProperty('/animationMode').attachChange(this.handleAnimationModeChange.bind(this));m.setProperty("/animationMode",o.animationMode);this._getPersonalizer().getPersData().then(function(U){m.setProperty("/animationMode",U?U:o.animationMode);o.animationMode=U?U:o.animationMode;}.bind(this));s.updateStateProperty("headerHiding",false,false,["home","app"]);}},_hideEditButton:function(){var e=sap.ui.getCore().byId("ActionModeBtn");if(e){e.setVisible(false);}},_getPreviousPageDirty:function(){return p;},_setPreviousPageDirty:function(e){p=e;},getModelConfiguration:function(){var v=this.getView().getViewData(),e,i;if(v){e=v.config||{};i=jQuery.extend({},e);}delete i.applications;return i;},_getLogonFrameProvider:function(){var v=this.getView();return{create:function(){return v.createIFrameDialog();},show:function(){v.showIFrameDialog();},destroy:function(){v.destroyIFrameDialog();}};},onExit:function(){sap.ui.getCore().getEventBus().unsubscribe("launchpad","contentRendered",this._loadCoreExt,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.loadUserImage,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.setBackGroundShapes,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.delayedCloseLoadingScreen,this);sap.ui.getCore().getEventBus().unsubscribe("launchpad","toggleContentDensity",this.toggleContentDensity,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this._loadCoreExtNonUI5,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);sap.ui.getCore().getEventBus().unsubscribe("launchpad","appClosed",this.logApplicationUsage,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell","coreResourcesFullyLoaded",this._postCoreExtActivities,this);sap.ui.getCore().getEventBus().unsubscribe("launchpad","launchpadCustomRouterRouteMatched",this._centerViewPort,this);sap.ui.getCore().getEventBus().unsubscribe("externalSearch",this.externalSearchTriggered,this);sap.ui.getCore().getEventBus().unsubscribe("showCatalog",this._hideEditButton,this);sap.ui.Device.media.detachHandler(this.onScreenSizeChange.bind(this),null,sap.ui.Device.media.RANGESETS.SAP_STANDARD);this.oShellNavigation.hashChanger.destroy();this.getView().aDanglingControls.forEach(function(e){if(e.destroyContent){e.destroyContent();}e.destroy();});sap.ushell.UserActivityLog.deactivate();if(sap.ushell.Container){if(sap.ushell.Container.getService("Notifications").isEnabled()===true){sap.ushell.Container.getService("Notifications").destroy();}}s.destroy();s=undefined;},handleAnimationModeChange:function(){var v=this.getView(),m=v.getModel(),e=m.getProperty('/animationMode'),E=e!=='minimal';C.enableAnimationDrawing(E);sap.ui.getCore().getEventBus().publish("launchpad","animationModeChange",e);},getAnimationType:function(){return"show";},onCurtainClose:function(e){jQuery.sap.log.warning("Closing Curtain",e);},handleDataLoss:function(e,i){if(!h){h=true;this.closeLoadingScreen();return this.oShellNavigation.NavigationFilterStatus.Custom;}if(sap.ushell.Container.getDirtyFlag()){if(!sap.ushell.resources.browserI18n){sap.ushell.resources.browserI18n=sap.ushell.resources.getTranslationModel(window.navigator.language).getResourceBundle();}if(confirm(sap.ushell.resources.browserI18n.getText("dataLossInternalMessage"))){sap.ushell.Container.setDirtyFlag(false);p=true;return this.oShellNavigation.NavigationFilterStatus.Continue;}h=false;hasher.setHash(i);return this.oShellNavigation.NavigationFilterStatus.Custom;}return this.oShellNavigation.NavigationFilterStatus.Continue;},doShowMessage:function(t,i,P){sap.ui.require(["sap/m/MessageToast","sap/m/MessageBox"],function(v,w){if(t===M.Type.ERROR){if(sap.ushell.Container&&sap.ushell.Container.getService("SupportTicket").isEnabled()&&i!==sap.ushell.resources.i18n.getText("supportTicketCreationFailed")){sap.ui.require(["sap/ushell/ui/launchpad/EmbeddedSupportErrorMessage"],function(E){try{var x=new E("EmbeddedSupportErrorMessage",{title:P.title||sap.ushell.resources.i18n.getText("error"),content:new sap.m.Text({text:i})});x.open();}catch(e){w.show(i,w.Icon.ERROR,P.title||sap.ushell.resources.i18n.getText("error"));}});}else{w.show(i,w.Icon.ERROR,P.title||sap.ushell.resources.i18n.getText("error"));}}else if(t===M.Type.CONFIRM){if(P.actions){w.show(i,w.Icon.QUESTION,P.title,P.actions,P.callback);}else{w.confirm(i,P.callback,P.title);}}else{v.show(i,{duration:P.duration||3000});}});},_isColdStart:function(){if(this.history.getHistoryLength()<=1){return true;}this._isColdStart=function(){return false;};return false;},_setEnableHashChange:function(v){h=v;},_logRecentActivity:function(R){if(o&&o.enableRecentActivity){setTimeout(function(){if(sap.ushell.Container){b.addActivity(R);}},700);}},_logOpenAppAction:function(e){if(o&&o.enableTilesOpacity&&o.enableRecentActivity){setTimeout(function(){if(sap.ushell.Container){var U=sap.ushell.Container.getService("UserRecents");U.addAppUsage(e);}},700);}},doHashChange:function(e,i,O,t,P){jQuery.sap.measure.start("FLP:ShellController.doHashChange","doHashChange","FLP");var v=this,w,x;u.addTime("ShellControllerHashChange");this.lastApplicationFullHash=t?O+t:O;if(!h){h=true;this.closeLoadingScreen();return;}if(P){this.hashChangeFailure(this.history.getHistoryLength(),P.message,null,"sap.ushell.renderers.fiori2.Shell.controller",false);return;}if(sap.m.InstanceManager&&g){sap.m.InstanceManager.closeAllDialogs();sap.m.InstanceManager.closeAllPopovers();}g=true;this.openLoadingScreen();if(u.getParameterValueBoolean("sap-ushell-no-ls")){this.closeLoadingScreen();}w=this.history.getHistoryLength();x=this.fixShellHash(e);this.history.hashChange(x,O);this.currentAppBeforeNav=b.getCurrentAppliction();this._resolveHashFragment(x).done(function(R,y){var z=y?y.semanticObject+"-"+y.action:"",o=v._getConfig(),E,T=R&&R.ui5ComponentName,D=!!T,G=R&&R.componentHandle;R=v._calculateNavigationMode(y,R);if(R&&(R.navigationMode===n.newWindow||u.isNativeWebGuiNavigation(R))){v._openAppInNewWindowAndRestore(R);return;}if(v.getModel().getProperty("/migrationConfig")){o.migrationConfig=false;v.getModel().setProperty("/migrationConfig",false);if(R&&x==='#'){o.rootIntent="";}else if(x==='#'){setTimeout(function(){hasher.setHash(o.rootIntent);},0);return;}}if(G){v._initiateApplication(R,x,y,w);return;}if(!D){v._initiateApplication(R,x,y,w);return;}if(o&&o.applications&&o.applications[z]){R.applicationConfiguration=o.applications[z];}E=v._getExistingAppAndDestroyIfNotRoot(z);if(E){v._initiateApplication(R,x,y,w);return;}else{b.setApplicationInInitMode();sap.ui.getCore().getEventBus().publish("ApplicationContainer","_prior.newUI5ComponentInstantion",{name:T});jQuery.sap.measure.start("FLP:ShellController.UI5createComponent","UI5 createComponent","FLP");sap.ushell.Container.getService("Ui5ComponentLoader").createComponent(R,y,v._createWaitForRendererCreatedPromise()).done(function(J){jQuery.sap.measure.end("FLP:ShellController.UI5createComponent");v._initiateApplication(R,x,y,w);}).fail(function(J){b.setCurrentApplication(v.currentAppBeforeNav);v.hashChangeFailure(w,"Failed to load UI5 component for navigation intent "+x,J,"sap.ushell.renderers.fiori2.Shell.controller",false);});}}).fail(function(y){var E;E="Failed to resolve navigation target: \""+x+"\""+". This is most likely caused by an incorrect SAP Fiori launchpad content configuration"+" or by missing role assignment.";v.hashChangeFailure(w,E,y,"sap.ushell.renderers.fiori2.Shell.controller",false);});jQuery.sap.measure.end("FLP:ShellController.doHashChange");},_initiateApplication:function(R,e,P,O){jQuery.sap.measure.start("FLP:ShellController._initiateApplication","_initiateApplication","FLP");var i=b.getMetadata(R);if(i.title){window.document.title=i.title;}else{jQuery.sap.log.debug("Shell controller._initiateApplication: the title of the window is not changed because most probably the application was resolved with undefined");}if(this.bContactSupportEnabled){sap.ushell.UserActivityLog.activate();}this._logOpenAppAction(e);try{this.navigate(P,e,i,R);}catch(E){if(E.stack){jQuery.sap.log.error("Application initialization (Intent: \n"+e+"\n failed due to an Exception:\n"+E.stack);}this.hashChangeFailure(O,E.name,E.message,i?i.title:"",false);}finally{if(R&&R.coreResourcesFullyLoaded&&!this._pluginLoadingTriggered){this._loadRendererExtensionPlugins();}}jQuery.sap.measure.end("FLP:ShellController._initiateApplication");},_resolveHashFragment:function(e){jQuery.sap.measure.start("FLP:ShellController._resolveHashFragment","_resolveHashFragment","FLP");var R,P,i=sap.ushell.Container.getService("URLParsing").parseShellHash(e),D=new jQuery.Deferred(),o=this._getConfig();P=i&&i.params||{};if(i&&i.contextRaw&&i.contextRaw==="navResCtx"&&P&&P.additionalInformation&&(P.additionalInformation[0]||P.additionalInformation[0]==="")&&P.applicationType&&P.applicationType[0]&&P.url&&P.url[0]&&P.navigationMode&&(P.navigationMode[0]||P.additionalInformation[0]==="")){P=i.params||{};R={additionalInformation:P.additionalInformation[0],applicationType:P.applicationType[0],url:P.url[0],navigationMode:P.navigationMode[0]};if(P.title){R.text=P.title[0];}D.resolve(R,i);}else{if(window["sap-ushell-async-libs-promise-directstart"]){window["sap-ushell-async-libs-promise-directstart"].then(function(t){D.resolve(t.resolvedHashFragment,i);delete window["sap-ushell-async-libs-promise-directstart"];},function(t){D.reject(t);delete window["sap-ushell-async-libs-promise-directstart"];});return D.promise();}sap.ushell.Container.getService("NavTargetResolution").resolveHashFragment(e).done(function(R){if(i&&(i.semanticObject+"-"+i.action)===o.rootIntent){R.navigationMode="embedded";}jQuery.sap.measure.end("FLP:ShellController._resolveHashFragment");D.resolve(R,i);}).fail(function(t){D.reject(t);});}return D.promise();},_calculateNavigationMode:function(P,R){if(!R){return undefined;}var e=R.navigationMode;if(e===n.newWindowThenEmbedded){if(this._isColdStart()||(P.contextRaw&&P.contextRaw==="navResCtx")||this.history.backwards){R.navigationMode=n.embedded;}else{R.navigationMode=n.newWindow;if(!u.isNativeWebGuiNavigation(R)){R.url=this._getCurrentLocationHash();}}return R;}if(e===n.newWindow&&this._isColdStart()){R.navigationMode=n.replace;return R;}return R;},_usesNavigationRedirect:function(e){if(!e){return new jQuery.Deferred().reject().promise();}var t=this,i=e.getInstance({});if(i&&typeof i.navigationRedirect==="function"){var D=new jQuery.Deferred();var v=i.navigationRedirect();if(v&&typeof v.then==="function"){v.then(function(w){jQuery.sap.log.warning("Performing navigation redirect to hash "+w);i.destroy();t.history.pop();sap.ushell.Container.getService("ShellNavigation").toExternal({target:{shellHash:w}},undefined,false);D.resolve(true);},function(){D.reject();});return D.promise();}}return new jQuery.Deferred().reject().promise();},navigate:function(P,e,i,R){jQuery.sap.measure.start("FLP:ShellController.navigate","navigate","FLP");var t=(jQuery.isPlainObject(R)?R.navigationMode:null),v=this;if(t===null){if(this._isColdStart()){hasher.setHash("");return;}h=false;this.history.pop();this._windowHistoryBack(1);return;}R=this._calculateNavigationMode(P,R);t=(jQuery.isPlainObject(R)?R.navigationMode:null);if(t===n.embedded){var D=this._usesNavigationRedirect(R.componentHandle);D.fail(function(){v._handleEmbeddedNavMode(e,P,i,R);if(P&&P.contextRaw==="navResCtx"){jQuery.sap.log.error(" This path will no longer be supported in 1.40");h=false;if(P&&P.params&&P.params.original_intent&&P.params.original_intent[0]){hasher.replaceHash(P.params.original_intent[0]);v.history._history[0]=P.params.original_intent[0];}}});jQuery.sap.measure.end("FLP:ShellController.navigate");return;}if(t===n.replace){h=false;this._changeWindowLocation(R.url);return;}if(t===n.newWindow){this._openAppInNewWindowAndRestore(R);return;}this.hashChangeFailure(this.history.getHistoryLength(),"Navigation mode is not recognized",null,"sap.ushell.renderers.fiori2.Shell.controller",false);},_openAppInNewWindowAndRestore:function(R){h=false;if(u.isNativeWebGuiNavigation(R)){try{var U=u.appendUserIdToUrl("sap-user",R.url);var E=u.getPrivateEpcm();E.doNavigate(U);}catch(e){if(e.stack){jQuery.sap.log.error("Application initialization failed due to an Exception:\n"+e.stack);}this.hashChangeFailure(this.history.getHistoryLength(),e.name,e.message,R.text,false);}}else{this._openAppNewWindow(R.url);}this.history.pop();var v=R.componentHandle&&R.componentHandle.getInstance&&R.componentHandle.getInstance({});if(v){v.destroy();}this._windowHistoryBack(1);b.setCurrentApplication(this.currentAppBeforeNav);return;},_handleEmbeddedNavMode:function(e,P,i,R){jQuery.sap.measure.start("FLP:ShellController._handleEmbeddedNavMode","_handleEmbeddedNavMode","FLP");var t,v,w,x,y;this.resetShellUIServiceHandlers();this.setAppIcons(i);t='-'+P.semanticObject+'-'+P.action;w=(R.applicationType==="NWBC"||R.applicationType==="TR");x=e==="#"||(o.rootIntent&&o.rootIntent===P.semanticObject+"-"+P.action);if(x&&!this.oHomeApp&&!o.disableHomeAppCache){this._saveHomePageComponent();}y=P?P.semanticObject+"-"+P.action:"";if(w&&!R.explicitNavMode){if(R.applicationType==="NWBC"&&o.appState&&o.appState==="headerless"){this.switchViewState("headerless");}else{this.switchViewState("minimal");}}else if(x){this.switchViewState("home");this.oShellUIService.setBackNavigation();}else{this.switchViewState("app");}v=this.getWrappedApplication(y,i,R,t,R.fullWidth||i.fullWidth||w);if(x&&!o.disableHomeAppCache){if(!this.oViewPortContainer.getInitialCenterViewPort()){this.oViewPortContainer.setInitialCenterViewPort(v);}}this.oViewPortContainer.navTo('centerViewPort',v.getId(),'show');this._centerViewPort();jQuery.sap.measure.end("FLP:ShellController._handleEmbeddedNavMode");},_centerViewPort:function(){this.oViewPortContainer.switchState("Center");},_getExistingAppAndDestroyIfNotRoot:function(i){var e;e=this.oViewPortContainer&&(this.oViewPortContainer.getViewPortControl('centerViewPort',"application"+'-'+i)||this.oViewPortContainer.getViewPortControl('centerViewPort',"applicationShellPage"+'-'+i));if(e&&i!==o.rootIntent){this.oViewPortContainer.removeCenterViewPort(e.getId(),true);e.destroy();return null;}else if(e){return e;}},getWrappedApplication:function(i,e,R,t,v){jQuery.sap.measure.start("FLP:ShellController.getWrappedApplication","getWrappedApplication","FLP");var E,w,x=this;E=this._getExistingAppAndDestroyIfNotRoot(i,t);if(E){this.closeLoadingScreen();return E;}setTimeout(function(){setTimeout(function(){var y;if(m.getProperty("/currentState/stateName")==="app"){y="shellAppTitle";}A.sendFocusBackToShell(y);setTimeout(function(){x.readNavigationEnd();},500);},100);sap.ui.getCore().getEventBus().publish("launchpad","appOpening",R);jQuery.sap.log.info('app is being opened');},0);if(o.applications){R.applicationConfiguration=o.applications[i];}w=this._getAppContainer(t,R);R.sShellHash=i;this.publishNavigationStateEvents(w,R);w.addStyleClass('sapUshellApplicationPage');if(!v){w.addStyleClass("sapUShellApplicationContainerLimitedWidth");}if(this._isDock()&&window.matchMedia('(min-width: 106.4rem)').matches){w.addStyleClass("sapUShellDockingContainer");w.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}else if(this._isDock()){w.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}w.toggleStyleClass('sapUshellDefaultBackground',!e.hideLightBackground);this._applyContentDensityByPriority();w.onfocusin=function(){A.bFocusOnShell=false;A.bFocusPassedToExternalHandlerFirstTime=false;};w.onfocusout=function(){A.bFocusOnShell=true;A.bFocusPassedToExternalHandlerFirstTime=true;};this.oViewPortContainer.addCenterViewPort(w);setTimeout(function(){x.closeLoadingScreen();},0);jQuery.sap.measure.end("FLP:ShellController.getWrappedApplication");return w;},resetShellUIServiceHandlers:function(){this.isHierarchyChanged=false;this.isTitleChanged=false;this.isRelatedAppsChanged=false;this.isBackNavigationChanged=false;},_publicEventDataFromResolutionResult:function(e){var P={};if(!e){return e;}["applicationType","ui5ComponentName","url","additionalInformation","text"].forEach(function(i){P[i]=e[i];});Object.freeze(P);return P;},onAppAfterRendering:function(e){setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appOpened",e);jQuery.sap.log.info('app was opened');},0);var i=this._publicEventDataFromResolutionResult(e);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appOpened",i);if(this.oShellUIService){if(!this.isHierarchyChanged){this.oShellUIService.setHierarchy();}if(!this.isTitleChanged){this.oShellUIService.setTitle();}if(!this.isRelatedAppsChanged){this.oShellUIService.setRelatedApps();}if(!this.isBackNavigationChanged){this.oShellUIService.setBackNavigation();}}s.updateStateProperty("application/icon",this.getAppIcon(),true);s.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},_getAppContainer:function(e,R){if(!this.oShellUIService){this.initShellUIService();}R.shellUIService=this.oShellUIService.getInterface();var i=new f("application"+e,R);return i;},_saveHomePageComponent:function(){if(this.oHomeApp){return;}var t=this,e="sap.ushell.components.container.ApplicationContainer",i=function(E,v,D){t.oHomeApp=D.component;sap.ui.getCore().getEventBus().unsubscribe(e,'componentCreated',i);};sap.ui.getCore().getEventBus().subscribe(e,'componentCreated',i);},hashChangeFailure:function(i,e,D,t,E){this.reportError(e,D,t);this.closeLoadingScreen();this.delayedMessageError(sap.ushell.resources.i18n.getText("fail_to_start_app_try_later"));g=false;if(i===0){hasher.setHash("");}else{if(jQuery.sap.getUriParameters().get("bFallbackToShellHome")){hasher.setHash("");}else{h=E;sap.ushell.Container.setDirtyFlag(p);this._windowHistoryBack(1);}}},reportError:function(e,D,i){jQuery.sap.log.error(e,D,i);},delayedMessageError:function(e){setTimeout(function(){if(sap.ushell.Container!==undefined){sap.ushell.Container.getService("Message").error(e);}},0);},fixShellHash:function(e){if(!e){e='#';}else if(e.charAt(0)!=='#'){e='#'+e;}return e;},publishNavigationStateEvents:function(e,i){var t,v=e.getId?e.getId():"",w=this;var x=b.getMetadata(),y=x.icon,T=x.title;e.addEventDelegate({onAfterRendering:this.onAppAfterRendering.bind(this,i)});t=e.exit;e.exit=function(){if(t){t.apply(this,arguments);}w._applyContentDensityByPriority();setTimeout(function(){var E=jQuery.extend(true,{},i);delete E.componentHandle;E["appId"]=v;E["usageIcon"]=y;E["usageTitle"]=T;sap.ui.getCore().getEventBus().publish("launchpad","appClosed",E);jQuery.sap.log.info('app was closed');},0);var P=w._publicEventDataFromResolutionResult(i);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appClosed",P);};},_openAppNewWindow:function(U){var e=window.open(U);if(!e){var i=sap.ushell.resources.i18n.getText("fail_to_start_app_popup_blocker");this.delayedMessageError(i);}},_windowHistoryBack:function(i){window.history.back(i);},_changeWindowLocation:function(U){window.location.href=U;},setAppIcons:function(e){sap.ui.require(["sap/ui/core/theming/Parameters"],function(P){jQuery.sap.measure.start("FLP:ShellController.setAppIcons","setAppIcons","FLP");var i=jQuery.sap.getModulePath("sap.ushell"),t=(e&&e.homeScreenIconPhone)||(i+'/themes/base/img/launchicons/57_iPhone_Desktop_Launch.png'),v=(e&&e["homeScreenIconPhone@2"])||(i+'/themes/base/img/launchicons/114_iPhone-Retina_Web_Clip.png'),w=(e&&e.homeScreenIconTablet)||(i+'/themes/base/img/launchicons/72_iPad_Desktop_Launch.png'),x=(e&&e["homeScreenIconTablet@2"])||(i+'/themes/base/img/launchicons/144_iPad_Retina_Web_Clip.png'),y=(e&&e.favIcon)||(this._getDefaultFavIcon(P)),z=this.getFavIconHref();if(sap.ui.Device.os.ios){jQuery.sap.setIcons({'phone':t,'phone@2':v,'tablet':w,'tablet@2':x,'favicon':y,'precomposed':false});}else if(z!==y){jQuery.sap.setIcons({'phone':'','phone@2':'','tablet':'','tablet@2':'','favicon':y,'precomposed':true});}jQuery.sap.measure.end("FLP:ShellController.setAppIcons");}.bind(this));},_getDefaultFavIcon:function(P){var e=P.get('@sapFavicon');if(e){var i=/url[\s]*\('?"?([^\'")]*)'?"?\)/.exec(e);if(i){e=i[1];}else if(e==="''"||e==="none"){e=null;}}if(!e){var t=jQuery.sap.getModulePath("sap.ushell");return t+'/themes/base/img/launchpad_favicon.ico';}return e;},handleEndItemsOverflow:function(P){var e=this.getModel().getProperty("/currentState/headEndItems");if(e.length===1||(e.length===2&&e.indexOf("NotificationsCountButton")!=-1)){return;}function i(){s.removeHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);var t=sap.ui.getCore().byId('headEndItemsOverflow');if(t){t.destroy();}}if(P.name==='Phone'||P.name==='Tablet'){if(e.indexOf("endItemsOverflowBtn")===-1){s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}else{i();s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}}else if(P.name==="Desktop"){if(P.showOverFlowBtn){if(e.indexOf("endItemsOverflowBtn")===-1){s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}}else{i();}}},isHeadEndItemOverflow:function(){var e=this.getModel().getProperty("/currentState/headEndItems");if(e.indexOf("endItemsOverflowBtn")===-1){return false;}else{var i=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD).name;var t=3;if(i==="Phone"){t=1;}if(sap.ui.getCore().byId("endItemsOverflowBtn").getVisible()){return e.length>t+1;}else{return e.length>t;}}},isHeadEndItemInOverflow:function(e){return e!=="ENDITEMSOVERFLOWBTN"&&!this.isHeadEndItemNotInOverflow(e);},isHeadEndItemNotInOverflow:function(e){if(this.isHeadEndItemOverflow()){if(e==="NOTIFICATIONSCOUNTBUTTON"||e==="ENDITEMSOVERFLOWBTN"){return true;}else{var i=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD).name;if(i==="Tablet"){if(e==="SF"||e==="FLOATINGCONTAINERBUTTON"){return true;}else{return false;}}else if(i==="Desktop"){if(e==="SF"||e==="FLOATINGCONTAINERBUTTON"||e==="COPILOTBTN"){return true;}else{return false;}}else if(i==="Phone"){return false;}else{return true;}}}else if(e==="ENDITEMSOVERFLOWBTN"){return false;}else{return true;}},pressEndItemsOverflow:function(e){if(!sap.ui.Device.system.desktop){var i=m.getProperty("/currentState").headerHiding;if(i){m.setProperty("/currentState/headerHiding",false);}}var P=sap.ui.getCore().byId('headEndItemsOverflow');function t(){if(P.isOpen()){P.close();}}var v;if(P){v=P.getContent()[0];}else{var w=new sap.ui.model.Filter('','EQ','a');w.fnTest=this.isHeadEndItemInOverflow.bind(this);v=new sap.ui.layout.VerticalLayout({content:{path:"/currentState/headEndItems",filters:[w],factory:function(x,y){var z=sap.ui.getCore().byId(y.getObject());z.detachPress(t);z.attachPress(t);return z;}}});P=new sap.m.Popover("headEndItemsOverflow",{placement:sap.m.PlacementType.Bottom,showHeader:false,showArrow:false,content:v}).addStyleClass("sapUshellPopupContainer");P.addStyleClass("sapMPopoverheadEndItemsOverflow");v.updateAggregation=this.getView().updateShellAggregation;P.setModel(m);this.getView().aDanglingControls.push(P);P.attachAfterClose(P,function(){if(!sap.ui.Device.system.desktop){if(i){m.setProperty("/currentState/headerHiding",i);}}});}if(P.isOpen()){P.close();}else{v.updateAggregation("content");P.openBy(e.getSource());}},getFavIconHref:function(){return jQuery('link').filter('[rel="shortcut icon"]').attr('href')||'';},externalSearchTriggered:function(e,E,D){m.setProperty("/searchTerm",D.searchTerm);D.query=D.searchTerm;},onAfterNavigate:function(e){this.closeLoadingScreen();var i=this.oViewPortContainer.getInitialCenterViewPort(),t=e.getParameter("fromId"),v=e.getParameter("from");if(t&&t!==i){this.oViewPortContainer.removeCenterViewPort(t,true);v.destroy();}u.addTime("ShellController.onAfterNavigate");if(e.mParameters&&e.mParameters.toId===i){sap.ui.getCore().byId("configBtn").focus();if(this.oHomeApp&&this.oHomeApp.setInitialConfiguration){this.oHomeApp.setInitialConfiguration();}}},logApplicationUsage:function(e,i,t){if(o&&o.enableRecentActivity){var v=t.appId,w=v,R={};R.title=t.usageTitle;R.appType=c.APP;R.url='#'+this.lastApplicationFullHash;if(v.indexOf('-')>0){w=v.substr(v.indexOf('-')+1);}R.appId='#'+w;if(w==="Action-search"){R.appType=c.SEARCH;}this._logRecentActivity(R);}},openLoadingScreen:function(){jQuery.sap.measure.start("FLP:ShellController.openLoadingScreen","openLoadingScreen","FLP");if(this.oFiori2LoadingDialog){var e=m.getProperty('/animationMode');var e=e||'full';this.oFiori2LoadingDialog.openLoadingScreen(e);}jQuery.sap.measure.end("FLP:ShellController.openLoadingScreen");},closeLoadingScreen:function(){if(this.oFiori2LoadingDialog){this.oFiori2LoadingDialog.closeLoadingScreen();}},readNavigationEnd:function(){var e=document.getElementById("sapUshellLoadingAccessibilityHelper-loadingComplete");if(e){e.setAttribute("aria-live","polite");e.innerHTML=sap.ushell.resources.i18n.getText("loadingComplete");setTimeout(function(){e.setAttribute("aria-live","off");e.innerHTML="";},0);}},delayedCloseLoadingScreen:function(){setTimeout(function(){this.closeLoadingScreen();}.bind(this),600);},togglePane:function(e){var i=e.getSource(),t=i.getSelected();sap.ui.getCore().getEventBus().publish("launchpad","togglePane",{currentContent:i.getModel().getProperty("/currentState/paneContent")});if(e.getParameter("id")==="categoriesBtn"){i.getModel().setProperty("/currentState/showCurtainPane",!t);}else{i.getModel().setProperty("/currentState/showPane",!t);}},_switchToNotificationView:function(e){this.oViewPortContainer.navTo('rightViewPort',"notificationsView",'show');this._switchViewPortStateByControl(e,"RightCenter");sap.ui.getCore().getEventBus().publish("launchpad","notificationViewOpened");},_switchToNotificationViewWithPreview:function(e,i,t){if(i==='minimal'){this._switchToNotificationView(t);}else{var v=e.getFloatingContainerItems().length;setTimeout(function(){this._switchToNotificationView(t);}.bind(this),300+(v*100));}},toggleNotificationsView:function(e,i){if(e){i=e.getSource();}if(!q){l.done(function(){this.toggleNotificationsView(undefined,i);}.bind(this));return;}var t,v=sap.ushell.Container.getService("Notifications"),w=sap.ui.getCore().byId("notifications-preview-container"),x=this.getView().getModel().getProperty('/animationMode')||'full';this.bMeAreaSelected=false;var y=sap.ui.getCore().byId("meAreaHeaderButton");if(y){y.setSelected(false);jQuery(y.getDomRef()).attr("aria-pressed","false");}if(!sap.ui.getCore().byId('notificationsView')){t=sap.ui.view("notificationsView",{viewName:"sap.ushell.renderers.fiori2.notifications.Notifications",type:'JS',viewData:{}});this.oViewPortContainer.addRightViewPort(t);}this.bNotificationsSelected=i.getSelected();if(this.bNotificationsSelected){this._switchViewPortStateByControl(i,"Center");}else{this.getView().getModel().setProperty("/notificationsCount",0);if(w){w.setFloatingContainerItemsVisiblity(false);this._switchToNotificationViewWithPreview(w,x,i);}else{this._switchToNotificationView(i);}}this.bNotificationsSelected=!this.bNotificationsSelected;i.setSelected(this.bNotificationsSelected);v.notificationsSeen();this.getView().getModel().setProperty("/notificationsCount",0);jQuery(i.getDomRef()).attr("aria-pressed",this.bNotificationsSelected);jQuery(i.getDomRef()).attr("aria-label",sap.ushell.resources.i18n.getText("NotificationToggleButtonCollapsedNoNotifications"));},toggleMeAreaView:function(e,i){if(e){i=e.getSource();}if(!q){l.done(function(){this.toggleMeAreaView(undefined,i);}.bind(this));return;}var t=i.getSelected(),m=this.getModel(),v=m.getProperty('/currentState/stateName');this.bMeAreaSelected=!t;if(v==='embedded'||v==='embedded-home'||v==='standalone'||v==='blank-home'||v==='blank'){if(!t){this.loadMeAreaView();}this._showActionsInPopOver(i);}else{this._switchToMeAreaView(i);}var w=sap.ui.getCore().byId("NotificationsCountButton");if(w&&this.bNotificationsSelected){this.bNotificationsSelected=false;w.setSelected(false);jQuery(w.getDomRef()).attr("aria-pressed","false");}jQuery(i.getDomRef()).attr("aria-pressed",this.bMeAreaSelected);},_showActionsInPopOver:function(O){var m=this.getModel(),e=m.getProperty('/currentState/actions');if(!this.oActionsPopover){this.oActionsLayout=new sap.ui.layout.VerticalLayout();this.oActionsPopover=new sap.m.Popover("sapUshellActionsPopover",{showHeader:false,placement:sap.m.PlacementType.Bottom,content:this.oActionsLayout}).addStyleClass("sapUshellPopupContainer");}this.oActionsLayout.removeAllContent();this._createActionButtons();e.forEach(function(i,t){var v=sap.ui.getCore().byId(i);if(v&&v.setActionType){this.oActionsLayout.addContent(v);v.setActionType('standard');v.addStyleClass('sapUshellStandardActionItem');}}.bind(this));this.oActionsPopover.openBy(O);this.oActionsPopover.setModel(m);},_switchToMeAreaView:function(O){var e=O.getSelected();if(e){this._switchViewPortStateByControl(O,"Center");}else{this._switchViewPortStateByControl(O,"LeftCenter");this.loadMeAreaView();}},_switchViewPortStateByControl:function(O,e){var i=false,v=this.oViewPortContainer;if(O&&O.setEnabled&&typeof O.setEnabled==="function"){i=true;}if(i){O.addStyleClass("sapUshellShellHeadItemOverrideDisableStyle");O.setEnabled(false);}function t(){O.setEnabled(true);O.removeStyleClass("sapUshellShellHeadItemOverrideDisableStyle");v.detachAfterSwitchStateAnimationFinished(t);}if(i){v.attachAfterSwitchStateAnimationFinished(t);}v.switchState(e);},onScreenSizeChange:function(P){this.validateShowLogo(P);this.handleNavMenuTitleVisibility(P);this._handleHomeAndBackButtonsVisibility(P);this.handleEndItemsOverflow(P);},_handleHomeAndBackButtonsVisibility:function(P){var m=a.getModel(),i=jQuery("#mainShell").width()<1024&&jQuery(".sapUshellContainerDocked").length>0,e=m.getProperty('/currentViewPortState')==='Center',t=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD).name,v=sap.ui.getCore().byId("homeBtn"),w=sap.ui.getCore().byId("backBtn"),x=t==="Desktop",y=t!=="Phone"||e;if(i){if(v){x=false;}}if(v){v.setVisible(x);}if(w){w.setVisible(y);}},validateShowLogo:function(P){var e;var i=this.getModel().getProperty('/currentState/stateName');var t=i==='merged'||i==='headerless';if(P){e=P.name;}else{e=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD).name;}var v=true;if(e==="Phone"&&!this.bMeAreaSelected||t){v=false;}s.updateStateProperty("showLogo",v,false,["home","app","blank","blank-home","minimal"],true);},handleNavMenuTitleVisibility:function(P){this.bNavMenuTitleVisible=false;if(P.name!=="Desktop"){this.bNavMenuTitleVisible=true;}s.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},navigateFromShellApplicationNavigationMenu:function(i){this.oViewPortContainer.switchState("Center");hasher.setHash(i);var e=sap.ui.getCore().byId("shellAppTitle");if(e){e.close();}},loadUserImage:function(){if(!this.bUserImageAlreadyLoaded){this.getView().loadUserImage();this.bUserImageAlreadyLoaded=true;}},_loadCoreExtNonUI5:function(e,E,i){if(i&&(i.applicationType=="NWBC"||i.applicationType=="TR")){setTimeout(this._loadCoreExt.bind(this),2000);}},_postCoreExtActivities:function(){sap.ushell.Container.getService("UsageAnalytics").init(sap.ushell.resources.i18n.getText("usageAnalytics"),sap.ushell.resources.i18n.getText("i_agree"),sap.ushell.resources.i18n.getText("i_disagree"),sap.ushell.resources.i18n.getText("remind_me_later"));var i=jQuery.Deferred();try{sap.ushell.Container.getService("EndUserFeedback").isEnabled().done(function(){m.setProperty('/showEndUserFeedback',true);i.resolve();}).fail(function(){m.setProperty('/showEndUserFeedback',false);i.resolve();});}catch(e){jQuery.sap.log.error("EndUserFeedback adapter is not found",e.message||e);m.setProperty('/showEndUserFeedback',false);i.resolve();}this.getView().createPostCoreExtControls();i.done(function(){this.loadMeAreaView();q=true;l.resolve();}.bind(this));},_loadRendererExtensionPlugins:function(){if(!this._pluginLoadingTriggered){this._pluginLoadingTriggered=true;jQuery.sap.log.info("Triggering load of 'RendererExtension' plug-ins after loading core-ext module (after home page content rendered)",null,"sap.ushell.renderers.fiori2.Shell");sap.ushell.Container.getService("PluginManager").loadPlugins("RendererExtensions");this._publishCoreExtLoadedEvent();}},_loadCoreExt:function(){jQuery.sap.measure.end("FLP:Container.InitLoading");var e=window['sap-ui-debug']===true?'sap/fiori/core-ext-light-dbg.js':'sap/fiori/core-ext-light.js',t=this;jQuery.sap._loadJSResourceAsync(e).then(function(){t._loadRendererExtensionPlugins();}).catch(function(){t._loadRendererExtensionPlugins();jQuery.sap.log.warning('failed to load sap.fiori.core-ext-light');});},_publishCoreExtLoadedEvent:function(){setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","coreExtLoaded");},0);},getCurrentViewportState:function(){var v=m.getProperty('/currentViewPortState');return v;},makeEndUserFeedbackAnonymousByDefault:function(e){this.oEndUserFeedbackConfiguration.anonymousByDefault=e;},showEndUserFeedbackLegalAgreement:function(e){this.oEndUserFeedbackConfiguration.showLegalAgreement=e;},_activateFloatingUIActions:function(w){if(w<417){this.oFloatingUIActions.disable();}else{this.oFloatingUIActions.enable();}},setFloatingContainerDragSelector:function(e){jQuery(e).addClass("sapUshellShellFloatingContainerSelector");sap.ui.require(["sap/ushell/UIActions"],function(U){if(this.oFloatingUIActions){this.oFloatingUIActions.delete();}this.oFloatingUIActions=new sap.ushell.UIActions({containerSelector:".sapUiBody",wrapperSelector:'.sapUshellShellFloatingContainerWrapper',draggableSelector:'.sapUshellShellFloatingContainerWrapper',rootSelector:".sapUiBody",cloneClass:"sapUshellFloatingContainer-clone",dragCallback:this._handleFloatingContainerUIStart.bind(this),endCallback:this._handleFloatingContainerDrop.bind(this),moveTolerance:3,onDragStartUIHandler:this._onDragStartUI.bind(this),onDragEndUIHandler:this._setFloatingContainerHeight.bind(this),dragAndScrollCallback:this._doDock.bind(this),switchModeDelay:1000,isLayoutEngine:false,isTouch:false,elementToCapture:e,debug:jQuery.sap.debug()});this._activateFloatingUIActions(jQuery(window).width());var t;jQuery(window).bind("resize",function(){clearTimeout(t);t=setTimeout(this._activateFloatingUIActions(jQuery(window).width()),300);}.bind(this));}.bind(this));},_doDock:function(e){jQuery.sap.measure.start("FLP:Shell.controller._doDock","dragging co-pilot element","FLP");var D=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD);if(D.name=="Desktop"){var w=jQuery(window).width();if(e){e.docked={};var i=e.docked;if(e.moveX>=w-64){i.dockPos="right";i.setIsDockingAreaOpen=true;this._openDockingArea(e);}else if(e.moveX<64){i.dockPos="left";i.setIsDockingAreaOpen=true;this._openDockingArea(e);}else{if(this._isDockingAreaOpen()){this._closeDockingArea(e);}if(jQuery("#canvas").hasClass('sapUshellContainerDocked')){this._handleCloseCanvas(e);}}}}jQuery.sap.measure.end("FLP:Shell.controller._doDock");},_finishDoDock:function(D){this._openDockingArea(false);var e=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");e.put("lastState","docked:"+D.dockPos);this._handleOpenCanvas(D);var w=jQuery('#sapUshellFloatingContainerWrapper');w.css("height","100%");jQuery("#shell-floatingContainer").addClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsDocked",D.dockPos);if(jQuery(".sapUShellApplicationContainerLimitedWidth").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellApplicationContainerLimitedWidth");jQuery('#application-Action-toappnavsample').addClass("sapUShellDockingContainer");}},_onResizeWithDocking:function(){this.onScreenSizeChange(sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD));setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appFinderWithDocking");},300);},_onDragStartUI:function(e){jQuery.sap.measure.start("FLP:Shell.controller._onDragStartUI","start drag","FLP");if(this._isDock()){var i=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");i.put("lastState","floating");jQuery("#sapUshellFloatingContainerWrapper").removeClass('sapUshellContainerDocked');$(".sapUshellShellFloatingContainerFullHeight").removeClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsUnDocked");jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");jQuery("#sapUshellFloatingContainerWrapper").addClass('sapUshellContainerDockedMinimizeCoPilot');jQuery(jQuery(".sapUshellContainerDockedMinimizeCoPilot")).on('webkitAnimationEnd oanimationend msAnimationEnd animationend',this._handleAnimations(false));this._handleCloseCanvas(e);}jQuery.sap.measure.end("FLP:Shell.controller._onDragStartUI");},_handleAnimations:function(i,D){var e=jQuery('#canvas');var w=jQuery('#sapUshellFloatingContainerWrapper');if(i){e.addClass("sapUshellContainerDockedLaunchpadTranisation");if(e.hasClass('sapUshellContainer-Narrow-Right')||D=="right"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeRight",true);}else{jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeLeft",true);}w.addClass(" sapUshellContainerDockedExtendCoPilot");setTimeout(function(){if(e.hasClass('sapUshellContainer-Narrow-Right')||D=="right"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeRight",false);jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openRight",true);}else if(e.hasClass('sapUshellContainer-Narrow-Left')||D=="left"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeLeft",false);jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openLeft",true);}},300);this._onResizeWithDocking();}else{jQuery("#sapUshellFloatingContainerWrapper").addClass("sapUshellContainerDockedExtendCoPilot");if(e.hasClass('sapUshellContainer-Narrow-Right')||D=="right"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openRight",false);}else{jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openLeft",false);}setTimeout(function(){e.removeClass("sapUshellContainerDockedLaunchpadTranisation  closeLeft  openLeft closeRight openRight")},550);}var t=sap.ui.getCore().byId('shell-header');t._handleResizeChange();},_openDockingArea:function(e){var D=e?e.docked:false;var i=D?D.setIsDockingAreaOpen:false;if(i&&jQuery("#DockinaAreaDiv").length==0){var t=sap.ui.getCore().getConfiguration().getRTL();if((D.dockPos==="right"&&e.clone&&!t)||(D.dockPos==="left"&&e.clone&&t)){jQuery('<div id="DockinaAreaDiv"  class="sapUshellShellDisplayDockingAreaRight">').appendTo(e.clone.parentElement);}else if((D.dockPos==="left"&&e.clone&&!t)||(D.dockPos==="right"&&e.clone&&t)){jQuery('<div id="DockinaAreaDiv"  class="sapUshellShellDisplayDockingAreaLeft">').appendTo(e.clone.parentElement);}e.clone.oDockedProp={};e.clone.oDockedProp.dockPos=D.dockPos;}else if(!i){this._closeDockingArea();}},_closeDockingArea:function(e){setTimeout(function(){jQuery('.sapUshellShellDisplayDockingAreaRight').remove();jQuery('.sapUshellShellDisplayDockingAreaLeft').remove();},150);var i=sap.ui.getCore().byId('shell-header');if(i){i._handleResizeChange();}},_isDock:function(){return(jQuery('.sapUshellContainerDocked').size()!=0);},_isDockingAreaOpen:function(){return(jQuery('.sapUshellShellDisplayDockingAreaRight').size()!=0||jQuery('.sapUshellShellDisplayDockingAreaLeft').size()!=0);},_handleOpenCanvas:function(D){var e=jQuery('#canvas');var w=jQuery('#sapUshellFloatingContainerWrapper');var i=sap.ui.getCore().getConfiguration().getRTL();if((D.dockPos==="right"&&!i)||(D.dockPos==="left"&&i)){e.addClass('sapUshellContainer-Narrow-Right sapUshellContainerDocked ');}if((D.dockPos==="left"&&!i)||(D.dockPos==="right"&&i)){e.addClass('sapUshellContainer-Narrow-Left sapUshellContainerDocked ');}var v=sap.ui.getCore().byId("viewPortContainer");if(v){v._handleSizeChange();}},_handleCloseCanvas:function(e){var i=jQuery('#canvas');if(e){e.docked.setIsDockingAreaOpen=false;}if(i.hasClass('sapUshellContainer-Narrow-Right')){i.removeClass('sapUshellContainer-Narrow-Right sapUshellContainerDocked sapUshellMoveCanvasRight');this._openDockingArea(e);this._setFloatingContainerHeight();}if(i.hasClass('sapUshellContainer-Narrow-Left')){i.removeClass('sapUshellContainer-Narrow-Left sapUshellContainerDocked sapUshellMoveCanvasLeft');this._openDockingArea(e);this._setFloatingContainerHeight();}if(jQuery(".sapUShellDockingContainer").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellDockingContainer");jQuery('#application-Action-toappnavsample').addClass("sapUShellApplicationContainerLimitedWidth");}this._onResizeWithDocking();var v=sap.ui.getCore().byId("viewPortContainer");if(v){v._handleSizeChange();}},_setFloatingContainerHeight:function(e){var w=jQuery(window).width();var W=jQuery('#sapUshellFloatingContainerWrapper');if(this._isDock()){if(e&&(e.clientX>=w-64||e.clientX<64)){W.addClass(' sapUshellContainerDocked');W.addClass("sapUshellContainerDockedMinimizeCoPilot");jQuery(W).on('webkitAnimationEnd oanimationend msAnimationEnd animationend',this._handleAnimations(true));}}else if(!this._isDock()){jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");}},_handleFloatingContainerDrop:function(e,i,D){jQuery.sap.measure.start("FLP:Shell.controller._handleFloatingContainerDrop","drop floating container","FLP");var t=i.firstChild?sap.ui.getCore().byId(i.firstChild.id):undefined,v=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.FloatingContainer"),w=jQuery(window).width(),W=jQuery(window).height(),P=D.deltaX/w,x=D.deltaY/W,O=i.style.visibility,y=i.style.display,z=parseFloat(i.style.left.replace("%","")),E=parseFloat(i.style.top.replace("%",""));i.style.visibility='hidden';i.style.display='block';if(typeof(z)==='number'){P=z+100*D.deltaX/w;}if(typeof(E)==='number'){x=E+100*D.deltaY/W;}if(this._isDockingAreaOpen()){x=0;}i.setAttribute("style","left:"+P+"%;top:"+x+"%;position:absolute;");i.visibility=O;i.display=y;v.put("floatingContainerStyle",i.getAttribute("style"));if(t){t.handleDrop();if(!!D.clone.oDockedProp&&this._isDockingAreaOpen()){this._finishDoDock(D.clone.oDockedProp);}}jQuery.sap.measure.end("FLP:Shell.controller.handleFloatingContainerDrop");},_handleFloatingContainerUIStart:function(i,t){jQuery.sap.measure.start("FLP:Shell.controller._handleFloatingContainerUIStart","starts dragging floating container","FLP");var v=t;v.style.display="none";if(window.getSelection){var w=window.getSelection();try{w.removeAllRanges();}catch(e){}}jQuery.sap.measure.end("FLP:Shell.controller._handleFloatingContainerUIStart");},getFloatingContainerState:function(){var e=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");var i="floating";if(e!=null){i=e.get("lastState");if(i==null){i="floating";}}return i;},setFloatingContainerVisibility:function(v){var e=this.getFloatingContainerState();if(e){if(e=="floating"){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}else if(e.indexOf("docked")!=-1){if(v==true){var D=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD);if(D.name=="Desktop"){var w=jQuery('#sapUshellFloatingContainerWrapper');w.addClass("sapUshellContainerDocked");jQuery("#canvas").addClass("sapUshellContainerDocked");w.css("height","100%");sap.ui.getCore().byId("shell-floatingContainer").addStyleClass("sapUshellShellFloatingContainerFullHeight");var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}if(sap.ui.getCore().getConfiguration().getRTL()){if(e.indexOf("right")!=-1){jQuery("#canvas").addClass('sapUshellContainer-Narrow-Left');this._handleAnimations(true,"left");}else{jQuery("#canvas").addClass('sapUshellContainer-Narrow-Right');this._handleAnimations(true,"right");}}else{if(e.indexOf("right")!=-1){jQuery("#canvas").addClass('sapUshellContainer-Narrow-Right');this._handleAnimations(true,"right");}else{jQuery("#canvas").addClass('sapUshellContainer-Narrow-Left');this._handleAnimations(true,"left");}}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}.bind(this),400);}else{storage.put("lastState","floating");this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}if(jQuery(".sapUShellApplicationContainerLimitedWidth").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellApplicationContainerLimitedWidth");jQuery('#application-Action-toappnavsample').addClass("sapUShellDockingContainer");}}else{if(sap.ui.getCore().getConfiguration().getRTL()){if(e.indexOf("right")!=-1){this._handleAnimations(false,"left");}else{this._handleAnimations(false,"right");}}else{if(e.indexOf("right")!=-1){this._handleAnimations(false,"right");}else{this._handleAnimations(false,"left");}}var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}.bind(this),400);if(jQuery(".sapUShellDockingContainer").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellDockingContainer");jQuery('#application-Action-toappnavsample').addClass("sapUShellApplicationContainerLimitedWidth");}}jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");this._onResizeWithDocking();var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}}}},getFloatingContainerVisibility:function(){return this.getView().getOUnifiedShell().getFloatingContainerVisible();},setFloatingContainerContent:function(P,i,e,t){s.setFloatingContainerContent(P,i,e,t);},getRightFloatingContainerVisibility:function(){var R=this.getView().getOUnifiedShell().getRightFloatingContainer(),e=R&&R.getVisible();return e;},setHeaderTitle:function(t,i){if(typeof t!=="string"){throw new Error("sTitle type is invalid");}this.getView().getOUnifiedShell().getHeader().setTitleControl(t,i);},addEndUserFeedbackCustomUI:function(e,i){if(e){this.oEndUserFeedbackConfiguration.customUIContent=e;}if(i===false){this.oEndUserFeedbackConfiguration.showCustomUIContent=i;}},setFooter:function(e){if(typeof e!=="object"||!e.getId){throw new Error("oFooter value is invalid");}if(this.getView().oShellPage.getFooter()!==null){jQuery.sap.log.warning("You can only set one footer. Replacing existing footer: "+this.getView().oShellPage.getFooter().getId()+", with the new footer: "+e.getId()+".");}this.getView().oShellPage.setFooter(e);},removeFooter:function(){if(this.getView().oShellPage.getFooter()===null){jQuery.sap.log.warning("There is no footer to remove.");return;}this.getView().oShellPage.setFooter(null);},addUserPreferencesEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateUserPrefModel(e);},addUserProfilingEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateProfilingModel(e);},_validateUserPrefEntryConfiguration:function(e){if((!e)||(typeof e!=="object")){throw new Error("object oConfig was not provided");}if(!e.title){throw new Error("title was not provided");}if(!e.value){throw new Error("value was not provided");}if(typeof e.entryHelpID!=="undefined"){if(typeof e.entryHelpID!=="string"){throw new Error("entryHelpID type is invalid");}else if(e.entryHelpID===""){throw new Error("entryHelpID type is invalid");}var i=sap.ui.getCore().byId('shell-header');i._handleResizeChange();}if(e.title&&typeof e.title!=="string"){throw new Error("title type is invalid");}if(typeof e.value!=="function"&&typeof e.value!=="string"&&typeof e.value!=="number"){throw new Error("value type is invalid");}if(e.onSave&&typeof e.onSave!=="function"){throw new Error("onSave type is invalid");}if(e.content&&typeof e.content!=="function"){throw new Error("content type is invalid");}if(e.onCancel&&typeof e.onCancel!=="function"){throw new Error("onCancel type is invalid");}},switchViewState:function(e,i){var t=e;if(e==='home'&&(o.appState==='embedded'||o.appState=='headerless'||o.appState=='merged'||o.appState=='blank')){t=o.appState+'-home';}else if(e==='app'&&k.indexOf(o.appState)>=0){t=o.appState;}var v=s.switchState(t,i);if(e==="searchResults"){m.setProperty("/lastSearchScreen",'');if(!hasher.getHash().indexOf("Action-search")===0){var w=sap.ui.getCore().getModel("searchModel");hasher.setHash("Action-search&/searchTerm="+w.getProperty("/uiFilter/searchTerms")+"&dataSource="+JSON.stringify(w.getProperty("/uiFilter/dataSource").getJson()));}}this._handleHomeAndBackButtonsVisibility();sap.ui.getCore().getEventBus().publish("launchpad","shellViewStateChanged",v);},_createSessionHandler:function(o){var t=this;sap.ui.require(["sap/ushell/SessionHandler"],function(e){t.oSessionHandler=new e();t.oSessionHandler.init({oModel:t.getModel(),keepSessionAlivePopupText:o.keepSessionAlivePopupText,pageReloadPopupText:o.pageReloadPopupText,preloadLibrariesForRootIntent:o.preloadLibrariesForRootIntent,sessionTimeoutReminderInMinutes:o.sessionTimeoutReminderInMinutes,sessionTimeoutIntervalInMinutes:o.sessionTimeoutIntervalInMinutes,enableAutomaticSignout:o.enableAutomaticSignout});});},_getSessionHandler:function(){return this.oSessionHandler;},_navBack:function(){this.bMeAreaSelected=false;j();},_historyBackNavigation:function(){window.history.back();},_updateUserPrefModel:function(e){var i=this._getModelEntryFromEntryObject(e),t=m.getProperty("/userPreferences/entries");t.push(i);t=this._reorderUserPrefEntries(t);m.setProperty("/userPreferences/entries",t);},_updateProfilingModel:function(e){var i=this._getModelEntryFromEntryObject(e),t=m.getProperty("/userPreferences/profiling")||[];t.push(i);m.setProperty("/userPreferences/profiling",t);},_getModelEntryFromEntryObject:function(e){return{"entryHelpID":e.entryHelpID,"title":e.title,"editable":e.content?true:false,"valueArgument":e.value,"valueResult":null,"onSave":e.onSave,"onCancel":e.onCancel,"contentFunc":e.content,"contentResult":null,"icon":e.icon};},pressActionBtn:function(e){if(!sap.ui.Device.system.desktop){var i=m.getProperty("/currentState").headerHiding;if(i){m.setProperty("/currentState/headerHiding",false);}}var t=sap.ui.getCore().byId('headActions');if(!t){this._createActionButtons();var v=new sap.ui.model.Filter('','EQ','a');v.fnTest=function(w){var x=m.getProperty("/currentState/actions"),y,z;for(z=0;z<x.length;z++){y=x[z];if(y.toUpperCase()==w){return!!sap.ui.getCore().byId(y);}}};t=new sap.m.ActionSheet("headActions",{placement:sap.m.PlacementType.Bottom,buttons:{path:"/currentState/actions",filters:[v],factory:function(w,x){var y=sap.ui.getCore().byId(x.getObject());if(y&&y.setActionType){y.setActionType("standart");}return y;}}});t.updateAggregation=this.getView().updateShellAggregation;t.setModel(m);this.getView().aDanglingControls.push(t);t.attachAfterClose(t,function(){if(!sap.ui.Device.system.desktop){if(i){m.setProperty("/currentState/headerHiding",i);}}});}t.updateAggregation("buttons");t.openBy(e.getSource());},_setUserPrefModel:function(){var e=m.getProperty("/userPreferences/entries");var D=this._getUserPrefDefaultModel();D.entries=D.entries.concat(e);D.entries=this._reorderUserPrefEntries(D.entries);m.setProperty("/userPreferences",D);},_reorderUserPrefEntries:function(e){var t,v;for(var i=0;i<e.length;i++){if(e[i].entryHelpID==="flpSettingsEntry"){t=i;}else if(e[i].entryHelpID==="themes"){v=i;}if(t!=undefined&&v!=undefined){var w=e.splice(t,1);e.splice(v+1,0,w[0]);break;}}return e;},_getSearchPrefs:function(){if(this._getIsSearchButtonEnabled()){sap.ui.require(['sap/ushell/renderers/fiori2/search/userpref/SearchPrefs','sap/ushell/renderers/fiori2/search/SearchShellHelperAndModuleLoader'],function(e){r=true;var i=e;var t=i.getEntry();t.isSearchPrefsActive().done(function(v){if(!v){return;}this.addUserProfilingEntry(t);}.bind(this));}.bind(this));}},_getUserPrefDefaultModel:function(){var t=this;var U=sap.ushell.Container.getUser();function G(K,O,P,Q,R,T,V,W,X,Y,m,Z,_){this.view=null;this.getView=function(){if(!this.view||!sap.ui.getCore().byId(K)){if(P==="xml"){this.view=sap.ui.xmlview(K,O);}else{this.view=sap.ui.jsview(K,O);}}if(m){this.view.setModel(m);}return this.view;};return{entryHelpID:Q,title:R,valueResult:null,onSave:T?T.bind(this):function(){if(this.getView().getController().onSave){return this.getView().getController().onSave();}return;}.bind(this),onCancel:V?V.bind(this):function(){if(this.getView().getController().onCancel){return this.getView().getController().onCancel();}return;}.bind(this),contentFunc:W?W.bind(this):function(){if(this.getView().getController().getContent){return this.getView().getController().getContent();}return;}.bind(this),valueArgument:X?X.bind(this):function(){var a1=jQuery.Deferred(),t=this;setTimeout(function(){if(t.getView().getController().getValue){t.getView().getController().getValue().done(function(b1){a1.resolve(b1);});}},0);return a1.promise();}.bind(this),editable:typeof Y==="function"?Y():Y,contentResult:null,icon:Z,defaultVisibility:_};}var e=new G("userPrefThemeSelector","sap.ushell.renderers.fiori2.theme_selector.ThemeSelector","xml","themes",sap.ushell.resources.i18n.getText("Appearance"),function(){var K=this.getView().getController().onSave();K.done(function(){if(m.getProperty("/tilesOpacity")===true){u.handleTilesOpacity();}});return K;},undefined,undefined,undefined,function(){if(m.getProperty("/setTheme")!==undefined){return m.getProperty("/setTheme")&&U.isSetThemePermitted();}else{return U.isSetThemePermitted();}},this.getView().getModel(),"sap-icon://palette");var i=new G("userPrefUsageAnalyticsSelector","sap.ushell.renderers.fiori2.usageAnalytics_selector.UsageAnalyticsSelector","js","usageAnalytics",sap.ushell.resources.i18n.getText("usageAnalytics"),undefined,undefined,undefined,undefined,sap.ushell.Container.getService("UsageAnalytics").isSetUsageAnalyticsPermitted());var v=new G("defaultParametersSelector","sap.ushell.renderers.fiori2.defaultParameters_selector.DefaultParameters","js",undefined,sap.ushell.resources.i18n.getText("defaultsValuesEntry"),undefined,undefined,undefined,undefined,true,undefined,undefined,false);var w=new G("userProfilingView","sap.ushell.renderers.fiori2.profiling.UserProfiling","js","userProfiling",sap.ushell.resources.i18n.getText("userProfiling"),undefined,undefined,undefined,undefined,false,this.getView().getModel(),"sap-icon://user-settings",false);function x(){this.view=null;this.getView=function getView(){if(!this.languageRegionSelector){this.languageRegionSelector=sap.ui.jsview("languageRegionSelector","sap.ushell.renderers.fiori2.userPreferences.LanguageRegionSelector");}return this.languageRegionSelector;};var K=function(){var R=this.getView().getController().onSave();return R;}.bind(this);var O=function(){return this.getView().getController().onCancel();}.bind(this);var P=function(){return this.getView().getController().getContent();}.bind(this);var Q=function(){return this.getView().getController().getValue();}.bind(this);return{entryHelpID:"language",title:sap.ushell.resources.i18n.getText("languageRegionTit"),editable:true,valueArgument:Q,valueResult:null,onSave:K,onCancel:O,contentFunc:P,contentResult:null,icon:"sap-icon://globe"};}function y(){this.view=null;this.getView=function getView(){if(!this.userAccountSelector){if(o.enableOnlineStatus&&sap.ushell.ui5service.UserStatus.prototype.isEnabled){this.userAccountSelector=sap.ui.xmlview("UserAccountSelector","sap.ushell.renderers.fiori2.userAccount.UserAccountSelector");}else{this.userAccountSelector=sap.ui.xmlview("UserAccountSetting","sap.ushell.renderers.fiori2.userAccount.UserAccountSetting");}}return this.userAccountSelector;};var K=function(){var R=this.getView().getController().onSave();return R;}.bind(this);var O=function(){return this.getView().getController().onCancel();}.bind(this);var P=function(){return this.getView().getController().getContent();}.bind(this);var Q=function(){return this.getView().getController().getValue();}.bind(this);return{entryHelpID:"userAccountEntry",title:sap.ushell.resources.i18n.getText("UserAccountFld"),editable:true,valueArgument:Q,valueResult:null,onSave:K,onCancel:O,contentFunc:P,contentResult:null,icon:"sap-icon://account"};}var z=[new y(),e,new x()],D=[];D.push(i);z.push(w);if(m.getProperty("/enableNotifications")===true){var E=sap.ushell.Container.getService("Notifications")._getNotificationSettingsAvalability(),J;J=new G("notificationSettings","sap.ushell.renderers.fiori2.notifications.Settings","js",undefined,sap.ushell.resources.i18n.getText("notificationSettingsEntry_title"),undefined,undefined,undefined,undefined,true,undefined,"sap-icon://ui-notifications",false);z.push(J);E.done(function(K){if(K.settingsAvailable){J.visible=true;m.getProperty("/userPreferences/entries").every(function(O,P){if(O.title===sap.ushell.resources.i18n.getText("notificationSettingsEntry_title")){m.setProperty("/userPreferences/entries/"+P+"/visible",true);return false;}return true;});}});}if(m.getProperty("/userDefaultParameters")){z.push(v);}return{dialogTitle:sap.ushell.resources.i18n.getText("userSettings"),isDetailedEntryMode:false,activeEntryPath:null,entries:z,profiling:D};},_getIsSearchButtonEnabled:function(){var m=this.getModel();try{var e=m.getProperty("/currentState/stateName");var D=m.getData();var i=D.states;if(i[e].headEndItems.indexOf("sf")!=-1){return true;}else{return false;}}catch(t){jQuery.sap.log.debug("Shell controller._createWaitForRendererCreatedPromise: search button is not visible.");return false;}},onAfterViewPortSwitchState:function(e){var t=e.getParameter("to");var i=sap.ui.getCore().byId("shellAppTitle");m.setProperty("/currentViewPortState",t);if(this.applicationKeyHandler){A.registerAppKeysHandler(this.applicationKeyHandler);this.applicationKeyHandler=undefined;}sap.ui.getCore().getEventBus().publish("launchpad","afterSwitchState",e);if(t==="Center"){i.setVisible(true);this.bMeAreaSelected=false;}else{i.setVisible(false);if(t==="Right"){this.bMeAreaSelected=false;}else if(t=="RightCenter"){this.applicationKeyHandler=A.getAppKeysHandler();A.bFocusOnShell=false;if(sap.ui.getCore().byId("notificationsView")){A.registerAppKeysHandler(sap.ui.getCore().byId("notificationsView").getController().keydownHandler.bind(sap.ui.getCore().byId("notificationsView")));}}}this.validateShowLogo();this._handleHomeAndBackButtonsVisibility();},getModel:function(){return m;},_getConfig:function(){return o?o:{};},_createWaitForRendererCreatedPromise:function(){var P,R;R=sap.ushell.Container.getRenderer();if(R){jQuery.sap.log.debug("Shell controller._createWaitForRendererCreatedPromise: shell renderer already created, return empty array.");return[];}else{P=new Promise(function(e,i){var O;O=function(){jQuery.sap.log.info("Shell controller: resolving component waitFor promise after shell renderer created event fired.");e();sap.ushell.Container.detachRendererCreatedEvent(O);};R=sap.ushell.Container.getRenderer();if(R){jQuery.sap.log.debug("Shell controller: resolving component waitFor promise immediately (shell renderer already created");e();}else{sap.ushell.Container.attachRendererCreatedEvent(O);}});return[P];}},_getPersonalizer:function(){if(this.oPersonalizer){return this.oPersonalizer;}var P=sap.ushell.Container.getService("Personalization");var e=sap.ui.core.Component.getOwnerComponentFor(this.getView());var i={keyCategory:P.constants.keyCategory.FIXED_KEY,writeFrequency:P.constants.writeFrequency.LOW,clientStorageAllowed:true};var t={container:"flp.launchpad.animation.mode",item:"animationMode"};this.oPersonalizer=P.getPersonalizer(t,i,e);return this.oPersonalizer;},_getCurrentLocationHash:function(){return window.location.hash;}});},false);
